(function(a){function w(){var d,c,t=[];e.find("li[id]").each(function(){n.push(a(this))});c=n.length;k.keypress(function(r,k){e.show();var p;if(k!=q){var g=0;if(document.selection)this.focus(),g=document.selection.createRange(),g.moveStart("character",-this.value.length),g=g.text.length;else if(this.selectionStart||"0"==this.selectionStart)g=this.selectionStart;8==k?p=this.value.slice(0,g-1)+this.value.slice(g):46==k&&(p=this.value.slice(0,g)+this.value.slice(g+1))}else p="."==String.fromCharCode(event.which)?
this.value+"\\"+String.fromCharCode(event.which):this.value+String.fromCharCode(event.which);var m=new RegExp(p,"ig");t=q;t=[];$resultsDiv.hide();d=0;b.search.showResults&&$resultsDiv.empty().append("<ul></ul>");a.each(n,function(){if(a(this).attr("id").match(m)||a(this).find("a").text().match(m))$resultsDiv.find("ul").append(a(this).clone(!0)),t.push(this),d+=1});b.search.showResults&&0<d&&0<p.length?($resultsDiv.show(),e.hide(),b.ecButtons.enable&&f.hide()):($resultsDiv.hide(),e.show(),b._ecButtons.enable&&
f.show());b.select.enable&&0<a("a.pbTree-current").length&&h.css(l());b.search.callback&&"function"===typeof b.search.callback&&b.search.callback(d,c,t)}).keydown(function(b){8!=b.keyCode&&46!=b.keyCode||a(this).trigger("keypress",[b.keyCode])})}function u(){e.find("li.pbTree-subRoot").removeClass("pbTree-opened").addClass("pbTree-closed");e.find("ul").hide()}function x(){e.find("li").each(function(){a(this).children().is("a")||(a(this).addClass("pbTree-subRoot"),b._showAll?a(this).addClass("pbTree-opened"):
(a(this).children("ul").hide(),a(this).addClass("pbTree-closed")))});b.showoccupied.enable&&e.find("li:has(a)").each(function(){a(this).css(b.showoccupied.style)})}function y(){e.css({paddingBottom:f.outerHeight()});f.find(".pbTree-expandAll").click(function(){e.find("li.pbTree-subRoot").removeClass("pbTree-closed").addClass("pbTree-opened");e.find("ul").show();b.select.enable&&0<a("a.pbTree-current").length&&h.show().css(l());return!1}).appendTo(f);f.find(".pbTree-collapseAll").click(function(){u();
d.animate({scrollTop:0},10);f.css("bottom",0);b.select.enable&&h.hide();return!1}).appendTo(f)}function v(b){b.each(function(){a(this).toggleClass("pbTree-opened").toggleClass("pbTree-closed");a(this).hasClass("pbTree-opened")?a(this).find("ul:first").show():a(this).find("ul:first").hide()})}function l(){return 0<a("a.pbTree-current").length&&e.is(":visible")?{top:parseInt(a("a.pbTree-current").position().top+e.position().top+d.scrollTop()),width:d[0].scrollWidth}:{top:parseInt(a("a.pbTree-current").position().top+
d.scrollTop()),width:d[0].scrollWidth}}var b={},n=[],d,e,r,m,h,f,k,q;a.fn.pbTree=function(n){d=a(this);e=d.find("ul:first");b=a.extend(!0,{ecButtons:{enable:!0},hover:{enable:!0},search:{enable:!1,selector:q,callback:q},select:{enable:!0},showall:!1,showoccupied:{enable:!0,style:{fontWeight:"bold",color:"#000000"}},tooltip:{enable:!0,offsetX:10,offsetY:10}},n);b.ecButtons.enable&&(f=a('<div id="pbTree-ecLinks"><a class="pbTree-expandAll" href="#">Expand All</a><a class="pbTree-collapseAll" href="#">Collapse All</a></div>').appendTo(d),
y());b.tooltip.enable&&(r=a('<div id="pbTree-tooltip"></div>').appendTo("body").hide());b.hover.enable&&(m=a('<div id="pbTree-hover"></div>').appendTo(d));b.select.enable&&(h=a('<div id="pbTree-selected"></div>').appendTo(d));if(b.search.enable)if(b.search.selector&&"string"===typeof b.search.selector)k=a(b.search.selector),w(b.search.selector);else return console.error("No input element provided"),1;else k=q;e.attr("id","pbTree-root").hide();x();e.find("a").each(function(){a(this).click(function(){0<
a("a.pbTree-current").length&&a("a.pbTree-current").removeClass("pbTree-current").removeAttr("style");b.showoccupied.enable&&a(this).css(b.showoccupied.style);a(this).addClass("pbTree-current");b.select.enable&&h.show().css(l())})});e.click(function(c){if(0<e.has(c.target).length&&a(c.target).hasClass("pbTree-subRoot")||c.target)c=a(c.target),c.hasClass("pbTree-opened")?(v(c),b.select.enable&&0<c.find("a.pbTree-current").length&&h.hide()):(v(c),b.select.enable&&0<c.find("a.pbTree-current").length&&
0>=c.find("li.pbTree-closed").length&&h.css(l()).show())}).mousemove(function(c){if(b.hover.enable&&0<e.has(c.target).length&&(a(c.target).is("li")||a(c.target).is("a"))&&(m.show().css({top:a(c.target).position().top+e.position().top+d.scrollTop()}),b.tooltip.enable)){var f=a(c.target).text().split("\n")[0];r.text(f).css({top:c.clientY+a(window).scrollTop()-b.tooltip.offsetY-r.outerHeight()+"px",left:c.clientX-b.tooltip.offsetX+"px"}).show()}}).mouseleave(function(){b.hover.enable&&b.tooltip.enable&&
(m.hide(),r.hide())});d.scroll(function(){b.select.enable&&0<a("a.pbTree-current").length&&0>=a("a.pbTree-current").parents("li.pbTree-closed").length&&h.css(l()).show();b.ecButtons.enable&&f.css({bottom:-d.scrollTop(),left:d.scrollLeft()})});e.show();return this};a.fn.pbTree.findOne=function(e,c){var d=a("#"+e);return 0<d.length?(c&&"boolean"===typeof c||(c=!0),c&&u(),0<a("a.pbTree-current").length&&a("a.pbTree-current").removeClass("pbTree-current"),d.parentsUntil("ul.pbTree-root").show().addClass("pbTree-opened"),
d.children("a").addClass("pbTree-current").trigger("click"),b.select.enable&&h.hide().css(l()).show(),this):!1}})(jQuery);